---
// Enhanced contact form with client-side validation
// Only loads JavaScript when visible (client:visible)
---

<div id="contact-form-container">
  <form 
    id="enhanced-contact-form"
    action="/api/contact"
    method="POST"
    class="space-y-4"
    novalidate
  >
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
        Name <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
      />
    </div>

    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
        Email <span class="text-red-500">*</span>
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
      />
    </div>

    <div>
      <label for="company" class="block text-sm font-medium text-gray-700 mb-1">
        Company <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="company"
        name="company"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
      />
    </div>

    <div>
      <label for="employees" class="block text-sm font-medium text-gray-700 mb-1">
        Number of Employees
      </label>
      <select
        id="employees"
        name="employees"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
      >
        <option value="">Select range</option>
        <option value="1-10">1-10</option>
        <option value="11-50">11-50</option>
        <option value="51-100">51-100</option>
        <option value="101-300">101-300</option>
        <option value="300+">300+</option>
      </select>
    </div>

    <div>
      <label for="message" class="block text-sm font-medium text-gray-700 mb-1">
        Message <span class="text-red-500">*</span>
      </label>
      <textarea
        id="message"
        name="message"
        rows="4"
        required
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
      ></textarea>
    </div>

    <div id="form-message" class="hidden text-sm"></div>

    <button
      type="submit"
      class="w-full bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors"
    >
      Send Message
    </button>
  </form>
</div>

<!-- Progressive Enhancement: Form works without JS, enhanced with JS -->
<script>
  // Only enhance if JavaScript is available
  const form = document.getElementById('enhanced-contact-form');
  const messageDiv = document.getElementById('form-message');
  
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Get form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);
      
      // Basic client-side validation
      if (!data.name || !data.email || !data.company || !data.message) {
        showMessage('Please fill in all required fields', 'error');
        return;
      }
      
      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(data.email)) {
        showMessage('Please enter a valid email address', 'error');
        return;
      }
      
      // Disable submit button
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';
      
      try {
        // Send to API
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(result.message, 'success');
          form.reset();
        } else {
          showMessage(result.error || 'Something went wrong', 'error');
        }
      } catch (error) {
        showMessage('Failed to send message. Please try again.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    });
  }
  
  function showMessage(text, type) {
    if (messageDiv) {
      messageDiv.textContent = text;
      messageDiv.className = `text-sm p-3 rounded-lg ${
        type === 'success' 
          ? 'bg-green-100 text-green-700' 
          : 'bg-red-100 text-red-700'
      }`;
      messageDiv.classList.remove('hidden');
      
      // Hide after 5 seconds
      setTimeout(() => {
        messageDiv.classList.add('hidden');
      }, 5000);
    }
  }
</script>